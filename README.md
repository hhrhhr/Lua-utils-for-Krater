Lua-utils-for-Krater
====================

unpack, parse, check and examine Lua scripts for Krater game

* идем сюда: https://github.com/hhrhhr/Lua-utils-for-Krater/tags
* качаем архивчик `v1.0.10.zip` (все используемые утилиты включены)
* распаковываем, редактируем файлик `_include.bat`:

        :: game directory
        set krater=f:\steam\steamapps\common\krater

* указываем свой путь к игре
* далее по очереди запускаем скрипты `step*.bat`
  + `step0_convert_localization_to_txt.bat`
      - создаст каталог `_work` и языковые файлы `game_strings_*.txt`
  + `step1_unpack_lua_scripts.bat`
      - распакует все игровые скрипты в каталог `_script`, затем декомпилирует их. на нескольких скриптах декомпилятор косячит, их список будет в файле `unlua_errors.log`, после первого прохода стартует второй вариант (менее наглядный)
  + `step2_export_for_translators.bat`
      - поиск строк жестко забитых в скрипты, затем полный обход всех известных квестов, предметов и тд. в каталоге `_work\for_translate` появятся исходные файлы для перевода.
  + теперь ручками надо создать каталог `_work\translated` и поместить туда переведенные файлики. при экспорте из гугла в текстовом формате остаются коментарии которые надо поудалять в конце файла, плюс все вхождения вида **[?]** (в скобках один символ)
  + `step3_import_translated.bat`
      - на этом шаге оригинальные файлы объединятся с переведенными
  + `step4_merge_lang_save_bin.bat`
      - тут текстовый файлик превратится в совместимый с игрой `game_strings.rus.bin`
  + `step5_generate_new_fonts.bat`
      - поиск всех используемых символов и генерация новых игровых шрифтов. я использовал свободные **Ubuntu**, **Cuprum**, **Marmelad** и **Neucha**. если таковых не окажется в системе, то нужно отредактировать файлик `lua\inc_fonts.lua`, изменив названия этих шрифтов. на остальное даже не дышать ;)
      - готовые текстуры и их дескрипторы появятся в `_work\new_fonts`.

остальные батники на скорость не влияют. остается самое рутинное, автоматом раскидать новые шрифты по нужным местам. если запустить батник `tool_extract_fonts.bat`, то в каталог `_work` скопируются текущие шрифты (чисто для посмотреть) и файл `font_list.txt`, который содержит соответствия между хэшированными и реальными названиями файлов. можно раскидать новые шрифты пользуясь этим файлом.

чтобы не было ошибок при запуске придется удалить файлы в каталоге `data\` (в самой игре):

        230b8ac979d9d395
        30d3ac7d103556ae
        33c9b8d393acaf70
        3ff9e9c5f68b4235
        46f4455f4676790b
        90b5903d8794e388
        9e13b2414b41b842
        c28c0b590a8de3f5
        eba393dbe3d1182f
        ec181385e7000cf1
        ff3483721c6c164c

файл локализации `game_strings.rus.bin` в оригинале должен называться `data\47\477f43f763bafe17`.

последний рывок в виде еще одного батника для автоматизации этих действий на подходе.
